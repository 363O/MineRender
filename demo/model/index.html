<!DOCTYPE html>
<html>
    <head>

        <style>
            body, html {
                overflow-x: hidden;
                overflow-y: hidden;
            }

            body {
                margin: 0;
            }

            canvas {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div style="position: fixed; right:10px; top:10px; background-color:lightgray; opacity: 50;z-index:10">
            <div style="margin: 10px;">
                <div>
                    <label for="nameInput">Model/Blockstate Name</label>
                    <input type="text" id="nameInput" value="stone">
                </div>
                <div>
                    <label for="typeInput">Type</label>
                    <select id="typeInput">
                        <option value="blockstate">BlockState</option>
                        <option value="model">Model</option>
                    </select>
                </div>
            </div>
            <div style="margin: 10px;">
                <div>
                    <label for="variantInput">Variant</label>
                    <select id="variantInput">
                    </select>
                </div>
            </div>
        </div>

        <div id="container"></div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js" integrity="sha256-NGC9JEuTWN4GhTj091wctgjzftr+8WNDmw0H8J5YPYE=" crossorigin="anonymous"></script>
        <script src="../../dist/model.js"></script>
        <script>
            (function () {

                window.modelRender = new ModelRender({
                    centerCubes: true,
                    camera: {
                        type: "perspective",
                        x: 20,
                        y: 15,
                        z: 20,
                        target: [0, 0, 0]
                    }
                }, document.getElementById("container"));

                function doRender() {
                    if (window.modelRender && window.modelRender._scene) {
                        window.modelRender.dispose();
                    }

                    let type = $("#typeInput").val();
                    let name = $("#nameInput").val();
                    let variant = $("#variantInput").val();

                    let option = {};
                    if (type === "blockstate") {
                        $("#variantInput").prop("disabled", false);

                        if (name.indexOf("/") !== -1) {
                            $("#nameInput").val(name.substr(name.indexOf("/") + 1));
                            name = name.substr(name.indexOf("/") + 1);
                        }
                        name = name.trim();

                        option["blockstate"] = name;
                        if (variant && variant.length > 0) {
                            option["variant"] = variant;
                        }
                    } else if (type === "model") {
                        $("#variantInput").prop("disabled", true);

                        if (name.indexOf("/") === -1) {
                            $("#nameInput").val("block/" + name);
                            name = "block/" + name;
                        }
                        name = name.trim();

                        option["model"] = name;
                    }

                    console.log(option);
                    window.modelRender.render([option], function () {
                        console.log(window.modelRender.blockstate);
                        $("#variantInput").empty();
                        for (let v in window.modelRender.blockstate.variants) {
                            $("#variantInput").append("<option value='" + v + "'>" + (v === "" ? "(normal)" : v) + "</option>");
                        }
                        if (variant && variant.length > 0) {
                            $("#variantInput").val(variant);
                        }
                    });
                }


                $("#typeInput").on("change", doRender);
                $("#nameInput").on("change", function () {
                    $("#variantInput").empty();
                    doRender();
                });
                $("#variantInput").on("change", doRender)

                // Initial render
                doRender();

                // window.modelRender.render([{
                //     model: "block/purpur_stairs",
                //     rotation: [0, 180, 0],
                //     offset: [16, 0, 16]
                // }], function () {
                //
                // });

                // let cancel = false;
                // document.body.addEventListener("modelRender", function () {
                //     if (cancel) {
                //         console.log("cancel!")
                //         cancelAnimationFrame(window.modelRender._animId);
                //     } else if (window.modelRender.models.length > 0) {
                //         console.log("should cancel")
                //         cancel = true;
                //     }
                // })
            })();
        </script>
    </body>
</html>